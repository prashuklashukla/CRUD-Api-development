<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Student Records</title>

    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background-color: #f5f6fa;
      }

      .profile-img {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
      }
    </style>
  </head>
  <body>
    <div class="container mt-4">
      <div class="card shadow">
        <div class="card-body">
          <h3 class="mb-3">Student Records</h3>

          <!-- Top Bar -->
          <div class="d-flex justify-content-between mb-3">
            <input
              type="text"
              id="searchStudent"
              class="form-control w-50"
              placeholder="Search by name"
            />

            <div>
              <button
                class="btn btn-success me-2"
                data-bs-toggle="modal"
                data-bs-target="#addStudentModal"
              >
                Add Student
              </button>

              <button class="btn btn-primary" onclick="fetchstudents()">
                Refresh
              </button>
            </div>
          </div>

          <!-- Table -->
          <div class="table-responsive">
            <table class="table table-bordered table-hover">
              <thead class="table-dark">
                <tr>
                  <th>Profile</th>
                  <th>First Name</th>
                  <th>Last Name</th>
                  <th>Email</th>
                  <th>phone</th>
                  <th>Gender</th>
                  <th>Actions</th>
                </tr>
              </thead>

              <tbody id="studentTable">
                <!-- Data comes from JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- View Student Modal -->
    <div class="modal fade" id="viewStudentModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Student Details</h5>

            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <img id="viewProfilePic" class="rounded mb-3" width="100" />
            <p>
              <strong>Name:</strong>
              <span id="viewName"></span>
            </p>
            <p>
              <strong>Email:</strong>
              <span id="viewEmail"></span>
            </p>
            <p>
              <strong>Phone:</strong>
              <span id="viewPhone"></span>
            </p>
            <p>
              <strong>Gender:</strong>
              <span id="viewGender"></span>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- add Student Modal -->

  <!-- Add Student Modal -->
<div class="modal fade" id="addStudentModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <form id="addStudentForm" enctype="multipart/form-data">

        <div class="modal-header">
          <h5 class="modal-title">Add Student</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">

          <div class="mb-2">
            <input
              type="text"
              class="form-control"
              name="first_name"
              placeholder="Enter First Name"
              required
            />
          </div>

          <div class="mb-2">
            <input
              type="text"
              class="form-control"
              name="last_name"
              placeholder="Enter Last Name"
              required
            />
          </div>

          <div class="mb-2">
            <input
              type="email"
              class="form-control"
              name="email"
              placeholder="Enter Email"
              required
            />
          </div>

          <div class="mb-2">
            <input
              type="text"
              class="form-control"
              name="phone"
              placeholder="Enter Phone"
              required
            />
          </div>

          <div class="mb-2">
            <select class="form-select" name="gender" required>
              <option value="">Select Gender</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
            </select>
          </div>

          <div class="mb-2">
            <label>Upload Profile Picture:</label>
            <input
              type="file"
              class="form-control"
              name="profite_pic"
              required
            />
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            Cancel
          </button>

          <button type="submit" class="btn btn-success">
            Create Student
          </button>
        </div>

      </form>

    </div>
  </div>
</div>


    <!-- Modal -->
    <div class="modal fade" id="studentModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add / Update Student</h5>

            <button class="btn-close" data-bs-dismiss="modal"></button>
          </div>

          <form id="studentForm">
            <div class="modal-body">
              <input type="hidden" id="studentId" />

              <div class="mb-2">
                <label class="form-label">First Name</label>
                <input
                  type="text"
                  name="first_name"
                  class="form-control"
                  required
                />
              </div>

              <div class="mb-2">
                <label class="form-label">Last Name</label>
                <input
                  type="text"
                  name="last_name"
                  class="form-control"
                  required
                />
              </div>

              <div class="mb-2">
                <label class="form-label">Email</label>
                <input
                  type="email"
                  name="email"
                  class="form-control"
                  required
                />
              </div>

              <div class="mb-2">
                <label class="form-label">Phone</label>
                <input type="text" name="phone" class="form-control" required />
              </div>
              <div class="mb-2">
                <label class="form-label">Gender</label>
                <input
                  type="text"
                  name="gender"
                  class="form-control"
                  required
                />
              </div>

              <div class="mb-2">
                <label class="form-label">Profile Image</label>
                <input type="file" name="profite_pic" class="form-control" />
              </div>
            </div>

            <div class="modal-footer">
              <button class="btn btn-secondary" data-bs-dismiss="modal">
                Cancel
              </button>

              <button type="submit" class="btn btn-success">Save</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Example JS -->

    <script>
      const apiUrl = "http://localhost:3000/api/student";

      // view all student
      async function fetchstudents(search = "") {
        const res = await fetch(
          `${apiUrl}?search=${encodeURIComponent(search)}`,
        );
        const data = await res.json();
        // console.log(data);
        const tbody = document.querySelector("#studentTable");
        tbody.innerHTML = ``;

        data.forEach((student) => {
          tbody.innerHTML += `
<tr>
            <td><img src="http://localhost:3000/uploads/${student.profite_pic}"  width='50' hight='50' class="rouded-circle"/></td>
            <td>${student.first_name}</td>
            <td>${student.last_name}</td>
            <td>${student.email}</td>
            <td>${student.phone}</td>
            <td>${student.gender}</td>
            <td>
  <button class="btn btn-info btn-sm" onclick="viewStudent('${student._id}')">View</button>
  <button class="btn btn-warning btn-sm" onclick="editStudent('${student._id}')">Edit</button>
  <button class="btn btn-danger btn-sm" onclick="deleteStudent('${student._id}')">Delete</button>
</td>
</tr>
 `;
        });
      }
      fetchstudents();

      //view student
      async function viewStudent(id) {
        const res = await fetch(`${apiUrl}/${id}`);
        const student = await res.json();
        // console.log(data);

        document.querySelector("#viewProfilePic").src =
          `http://localhost:3000/uploads/${student.profite_pic}`;

        document.querySelector("#viewName").textContent =
          `${student.first_name} ${student.last_name} `;
        document.querySelector("#viewEmail").textContent = student.email;
        document.querySelector("#viewPhone").textContent = student.phone;
        document.querySelector("#viewGender").textContent = student.gender;

        new bootstrap.Modal(document.querySelector("#viewStudentModal")).show();
      }

      // search student
      document.querySelector("#searchStudent").addEventListener("input", () => {
        fetchstudents(document.querySelector("#searchStudent").value);
      });

      //Add student
     document
  .querySelector("#addStudentForm")
  .addEventListener("submit", async function (e) {

    e.preventDefault();

    const formData = new FormData(this);

    try {

      const res = await fetch("http://localhost:3000/api/student", {
        method: "POST",
        body: formData,
      });

      const data = await res.json();

      if (res.ok) {

        alert("Student added successfully");

        this.reset();

        const modal = bootstrap.Modal.getInstance(
          document.querySelector("#addStudentModal")
        );

        modal.hide();

        fetchstudents();

      } else {

        alert(data.message || "Error adding student");

      }

    } catch (err) {

      console.error(err);

      alert("Server error");

    }

  });

    </script>
  </body>
</html>
